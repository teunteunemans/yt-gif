---
phase: 02-youtube-integration
plan: 01
type: execute
depends_on: []
files_modified: [src/entrypoints/youtube.content.ts, src/entrypoints/youtube.content/index.tsx, src/entrypoints/youtube.content/GifButton.tsx, src/entrypoints/youtube.content/style.css]
---

<objective>
Inject "GIF it!" button into YouTube video toolbar that appears on watch pages.

Purpose: Enable users to initiate GIF creation from any YouTube video with a single click.
Output: Content script with button injection, SPA navigation handling, and Shadow DOM isolation.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
./summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/01-foundation/01-01-SUMMARY.md
@src/entrypoints/background.ts
@wxt.config.ts

**Tech stack available:** WXT 0.20.13, React 19, @wxt-dev/module-react
**Established patterns:** srcDir structure (src/entrypoints/{name}), cross-browser builds

**Research findings (from discovery):**
- YouTube toolbar selector: `#top-level-buttons-computed` inside `ytd-menu-renderer.ytd-watch-metadata`
- Video element: `video.html5-main-video`
- SPA navigation: Use `wxt:locationchange` event from WXT ctx, or YouTube's native `yt-navigate-finish` event
- Shadow DOM recommended for CSS isolation to prevent YouTube styles from affecting button
- Content script file naming: `*.content.ts` or `*.content/index.tsx` for React
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create YouTube content script with video detection</name>
  <files>src/entrypoints/youtube.content/index.tsx, src/entrypoints/youtube.content/App.tsx</files>
  <action>
Create WXT content script for YouTube watch pages using React UI approach with Shadow DOM:

1. Create `src/entrypoints/youtube.content/index.tsx`:
   - Use `defineContentScript` with matches: `['*://*.youtube.com/watch*']`
   - Use `createShadowRootUi` for CSS isolation
   - Set cssInjectionMode: 'ui' in wxt.config.ts for this entrypoint
   - Find the toolbar container: `#top-level-buttons-computed`
   - If toolbar not found, use MutationObserver to wait for it (YouTube loads dynamically)
   - Mount React component into Shadow DOM anchor

2. Create `src/entrypoints/youtube.content/App.tsx`:
   - Simple component that renders the GIF button
   - Export for use by content script

Use WXT's createShadowRootUi pattern to avoid YouTube CSS affecting our button styles.
Do NOT use inline styles extensively - rely on Shadow DOM isolation and a separate CSS file.
  </action>
  <verify>
pnpm run build && ls -la .output/chrome-mv3/content-scripts/
# Should show youtube.js content script bundle
  </verify>
  <done>Content script builds successfully, targets YouTube watch pages, uses Shadow DOM</done>
</task>

<task type="auto">
  <name>Task 2: Implement GIF button component with YouTube-style appearance</name>
  <files>src/entrypoints/youtube.content/App.tsx, src/entrypoints/youtube.content/style.css</files>
  <action>
Create the "GIF it!" button component that matches YouTube's toolbar button style:

1. Update `App.tsx`:
   - Render a button with "GIF" text and a simple icon (use emoji ðŸŽ¬ or SVG)
   - onClick handler that logs to console for now (Phase 3 will add actual functionality)
   - Button should visually match YouTube's toolbar buttons (rounded pill shape, similar sizing)

2. Create `src/entrypoints/youtube.content/style.css`:
   - Style the button to match YouTube's design language:
     - Background: transparent or subtle (like YouTube's share/save buttons)
     - Text: white/light for dark theme compatibility
     - Padding/margin to match adjacent buttons
     - Hover state with subtle background change
     - Rounded corners (border-radius: 18px like YouTube pills)
   - Include both light and dark theme support using CSS variables or media query

The button should look native to YouTube, not like an obvious extension injection.
Do NOT add complex state management yet - just a simple button that logs clicks.
  </action>
  <verify>
pnpm run dev
# Open YouTube video page, verify button appears in toolbar
# Check button styling matches YouTube's design
# Click button and verify console.log appears
  </verify>
  <done>Button renders in toolbar with YouTube-native styling, click logs to console</done>
</task>

<task type="auto">
  <name>Task 3: Handle SPA navigation for video-to-video browsing</name>
  <files>src/entrypoints/youtube.content/index.tsx</files>
  <action>
YouTube is an SPA - navigating between videos doesn't reload the page. Handle this:

1. Update content script to listen for navigation:
   - Use WXT's `ctx.addEventListener(window, 'wxt:locationchange', handler)`
   - On location change, check if still on /watch page
   - If on watch page, re-inject button (toolbar DOM may have changed)
   - If NOT on watch page (e.g., navigated to home), clean up/unmount UI

2. Handle toolbar not being immediately available:
   - YouTube loads the toolbar asynchronously after navigation
   - Use a small delay or MutationObserver to wait for `#top-level-buttons-computed`
   - Retry injection up to 5 times with 500ms intervals if toolbar not found

3. Prevent duplicate buttons:
   - Before injecting, check if button already exists
   - Remove existing button before re-injecting on navigation

Use WXT's ctx.isValid to check if extension context is still valid before operations.
Do NOT use aggressive polling - prefer MutationObserver for efficiency.
  </action>
  <verify>
pnpm run dev
# 1. Open YouTube video - button appears
# 2. Click another video in sidebar - button appears on new video
# 3. Navigate to YouTube home - button should not appear/should be removed
# 4. Navigate back to a video - button appears again
  </verify>
  <done>Button persists across SPA navigation, appears only on watch pages, no duplicates</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `pnpm run build` succeeds for both Chrome and Firefox
- [ ] Content script loads on YouTube watch pages
- [ ] Button appears in video toolbar (below video, near like/share)
- [ ] Button styling matches YouTube's native buttons
- [ ] Navigating between videos keeps button visible
- [ ] Navigating away from watch page hides/removes button
- [ ] No console errors related to extension
</verification>

<success_criteria>

- All tasks completed
- All verification checks pass
- Button visible and clickable on any YouTube video
- SPA navigation handled correctly
- No visual regressions or conflicts with YouTube UI
</success_criteria>

<output>
After completion, create `.planning/phases/02-youtube-integration/02-01-SUMMARY.md`:

# Phase 2 Plan 1: YouTube Integration Summary

**[Substantive one-liner about what was built]**

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- [File list with descriptions]

## Decisions Made
- [Key decisions and rationale]

## Issues Encountered
- [Problems and resolutions]

## Next Phase Readiness
- [Ready for Phase 3: GIF Creation]
</output>
