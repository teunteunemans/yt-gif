---
phase: 04.1-ux-polish
plan: 02
type: execute
depends_on: ["04.1-01"]
files_modified: [src/entrypoints/youtube.content/GifCreator.tsx, src/entrypoints/popup/App.tsx, src/entrypoints/background.ts]
---

<objective>
Add video click-to-set-time functionality and make toolbar popup open the GIF menu.

Purpose: Streamline time selection and provide alternative entry point via browser toolbar.
Output: Clicking video sets start time; toolbar icon opens GIF creator.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-plan.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/04.1-ux-polish/04.1-01-SUMMARY.md
@src/entrypoints/youtube.content/GifCreator.tsx
@src/entrypoints/youtube.content/App.tsx
@src/entrypoints/youtube.content/index.tsx
@src/entrypoints/popup/App.tsx
@src/entrypoints/background.ts

**Fixes in this plan:**
1. Click video to set start time (live update while modal is open)
2. Toolbar popup button opens GIF menu instead of counter
</context>

<tasks>

<task type="auto">
  <name>Task 1: Click video to set start time</name>
  <files>src/entrypoints/youtube.content/GifCreator.tsx</files>
  <action>
When the GIF creator modal is open, clicking on the video should set the start time to the video's current playback position.

1. **Add video click listener in GifCreator**:
   - In useEffect, add click listener to videoElement
   - On click: get videoElement.currentTime, format as MM:SS, update startTimeStr
   - Also update endTimeStr to be startTime + (current endTime - current startTime) to maintain duration
   - OR simpler: just update startTimeStr, keep endTimeStr as is (user can adjust)

2. **Implementation**:
   ```tsx
   useEffect(() => {
     const handleVideoClick = () => {
       const newStart = videoElement.currentTime;
       setStartTimeStr(formatTime(newStart));
       // Optionally adjust end time to maintain duration:
       // const currentDuration = parseTime(endTimeStr) - parseTime(startTimeStr);
       // setEndTimeStr(formatTime(newStart + currentDuration));
     };

     videoElement.addEventListener('click', handleVideoClick);
     return () => videoElement.removeEventListener('click', handleVideoClick);
   }, [videoElement]);
   ```

3. **Visual feedback** (optional): Brief highlight or tooltip showing "Start time set to X:XX" when clicking video. Could be a small toast or just rely on the input updating.

4. **Edge cases**:
   - If clicked time > current endTime, adjust endTime to clicked + 3s (or some default)
   - Ensure video stays playing/paused as user expects (click shouldn't affect playback state beyond what YouTube does)
  </action>
  <verify>
- npm run build succeeds
- Open YouTube video, open GIF modal
- Click on video at different points
- Verify: Start time input updates to match video's currentTime
- Verify: Video playback is not disrupted
  </verify>
  <done>
- Clicking video updates start time in modal
- End time adjusts if needed (or stays, user preference)
- No interference with normal video playback controls
  </done>
</task>

<task type="auto">
  <name>Task 2: Toolbar popup opens GIF menu</name>
  <files>src/entrypoints/popup/App.tsx, src/entrypoints/background.ts, src/entrypoints/youtube.content/index.tsx</files>
  <action>
The browser extension toolbar icon click should open the GIF creator modal on the current YouTube video tab, instead of showing a counter popup.

**Approach**: Use message passing from popup to content script.

1. **Update popup/App.tsx**:
   - Remove counter state and button
   - On popup mount, immediately send message to active tab to open GIF creator
   - Show minimal UI: "Opening GIF creator..." or just close popup immediately

   ```tsx
   import { useEffect } from 'react';

   export default function App() {
     useEffect(() => {
       // Send message to content script to open GIF creator
       browser.tabs.query({ active: true, currentWindow: true }).then(tabs => {
         if (tabs[0]?.id) {
           browser.tabs.sendMessage(tabs[0].id, { action: 'openGifCreator' })
             .then(() => window.close()) // Close popup after sending
             .catch(err => {
               // Not on YouTube or content script not loaded
               console.log('Cannot open GIF creator:', err);
             });
         }
       });
     }, []);

     return (
       <div style={{ padding: '16px', minWidth: '200px' }}>
         <p>Opening GIF creator...</p>
         <p style={{ fontSize: '12px', color: '#666' }}>
           Navigate to a YouTube video to use YT-GIF
         </p>
       </div>
     );
   }
   ```

2. **Update content script (index.tsx or App.tsx)**:
   - Listen for messages from popup
   - On 'openGifCreator' message, trigger the same action as clicking the GIF button

   In App.tsx, expose a way to open the creator:
   ```tsx
   // Add message listener
   useEffect(() => {
     const handleMessage = (message: { action: string }) => {
       if (message.action === 'openGifCreator') {
         handleClick(); // Same as button click
       }
     };
     browser.runtime.onMessage.addListener(handleMessage);
     return () => browser.runtime.onMessage.removeListener(handleMessage);
   }, []);
   ```

3. **Handle non-YouTube pages**: If popup is clicked when not on YouTube, show helpful message instead of error.

4. **Alternative approach** (simpler): Instead of message passing, the popup could inject a script or use browser.scripting.executeScript to trigger the button click. But message passing is cleaner.
  </action>
  <verify>
- npm run build succeeds
- Load extension
- Navigate to YouTube video
- Click extension icon in browser toolbar
- Verify: GIF creator modal opens (same as clicking in-page GIF button)
- Navigate to non-YouTube page
- Click extension icon
- Verify: Shows helpful message (not error)
  </verify>
  <done>
- Toolbar icon click opens GIF creator on YouTube videos
- Non-YouTube pages show informative message
- Counter popup removed
  </done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] Click video to set start time works
- [ ] Toolbar popup opens GIF creator on YouTube
- [ ] Non-YouTube pages handled gracefully
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Phase 4.1 complete - all 7 UX fixes implemented
</success_criteria>

<output>
After completion, create `.planning/phases/04.1-ux-polish/04.1-02-SUMMARY.md`
</output>
